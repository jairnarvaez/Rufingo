{% extends 'flashcards/base.html' %}

{% block title %}Dashboard - Rufingo{% endblock %}

{% block content %}
<h1>ðŸ“– Dashboard de Rufingo</h1>

<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 30px 0;">
    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; text-align: center;">
        <h2 style="color: white; font-size: 48px; margin: 0;">{{ total_tarjetas }}</h2>
        <p style="margin: 10px 0 0 0; opacity: 0.9;">Total de Tarjetas</p>
    </div>
    
    <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 20px; border-radius: 10px; text-align: center;">
        <h2 style="color: white; font-size: 48px; margin: 0;">{{ tarjetas_pendientes }}</h2>
        <p style="margin: 10px 0 0 0; opacity: 0.9;">Pendientes Hoy</p>
    </div>
    
    <div style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white; padding: 20px; border-radius: 10px; text-align: center;">
        <h2 style="color: white; font-size: 24px; margin: 0;">{{ tarjetas_nuevas_hoy }} / {{ max_tarjetas_nuevas }}</h2>
        <p style="margin: 10px 0 0 0; opacity: 0.9;">Nuevas Hoy</p>
    </div>
</div>

<div style="margin-top: 40px;">
    <h2>ðŸ“Š DistribuciÃ³n por Estado</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px;">

        <div style="background: #d1ecf1; padding: 15px; border-radius: 8px; border-left: 4px solid #17a2b8;">
            <strong>ðŸ“š Aprendizaje:</strong> {{ tarjetas_aprendizaje }}
        </div>
        <div style="background: #d4edda; padding: 15px; border-radius: 8px; border-left: 4px solid #28a745;">
            <strong>ðŸŽ¯ ConsolidaciÃ³n:</strong> {{ tarjetas_consolidacion }}
        </div>
        <div style="background: #cce5ff; padding: 15px; border-radius: 8px; border-left: 4px solid #004085;">
            <strong>âœ… Maduras:</strong> {{ tarjetas_maduras }}
        </div>
    </div>
</div>

<div id="contenedor-repaso" 
     style="margin-top: 40px; text-align: center; display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
    {% if tarjetas_pendientes > 0 %}
    <a id="boton-repaso" href="{% url 'sesion_repaso' %}" class="btn" 
       style="font-size: 20px; padding: 18px 40px; background: #28a745;">
        ðŸŽ¯ Comenzar Repaso ({{ tarjetas_pendientes }} pendiente{{ tarjetas_pendientes|pluralize }})
    </a>
    {% endif %}
    <a href="{% url 'crear_tarjeta' %}" class="btn" style="font-size: 18px; padding: 15px 30px;">âž• Crear Nueva Tarjeta</a>
</div>


<script>
async function actualizarBotonRepaso() {
    try {
        const response = await fetch("{% url 'tarjetas_pendientes_api' %}");
        const data = await response.json();
        const contenedor = document.getElementById('contenedor-repaso');
        const botonExistente = document.getElementById('boton-repaso');

        if (data.pendientes > 0) {
            // Crear o actualizar el botÃ³n
            const texto = `ðŸŽ¯ Comenzar Repaso (${data.pendientes} pendiente${data.pendientes === 1 ? '' : 's'})`;
            if (botonExistente) {
                botonExistente.textContent = texto;
            } else {
                const nuevoBoton = document.createElement('a');
                nuevoBoton.id = 'boton-repaso';
                nuevoBoton.href = "{% url 'sesion_repaso' %}";
                nuevoBoton.className = 'btn';
                nuevoBoton.style = "font-size: 20px; padding: 18px 40px; background: #28a745;";
                nuevoBoton.textContent = texto;
                contenedor.prepend(nuevoBoton);
            }
        } else if (botonExistente) {
            // Eliminar el botÃ³n si ya no hay tarjetas
            botonExistente.remove();
        }
    } catch (error) {
        console.error('Error al actualizar botÃ³n de repaso:', error);
    }
}

// Ejecutar al cargar y cada 30s
actualizarBotonRepaso();
setInterval(actualizarBotonRepaso, 5000);
</script>


{% endblock %}
