{% extends 'flashcards/base.html' %}

{% block title %}Rufingo{% endblock %}

{% block content %}
<h1> Dashboard de Rufingo</h1>

<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(20px, 1fr)); gap: 20px; margin: 30px 0;">
    <div style="background: linear-gradient(135deg, #FFFFFF 0%, #FFFFFF 100%); color: #424242; padding: 20px; border-radius: 10px; text-align: center;  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.35);">
        <h2 style="font-size: 48px; margin: 0;">{{ total_tarjetas }}</h2>
        <p style="margin: 10px 0 0 0; opacity: 0.9;">Total de Tarjetas</p>
    </div>
    
    <div style="background: linear-gradient(135deg, #0039A6 0%, #0039A6 100%); color: white; padding: 20px; border-radius: 10px; text-align: center; box-shadow: 0 8px 20px rgba(0, 0, 0, 0.35);">
        <h2 style="font-size: 48px; margin: 0;">{{ tarjetas_pendientes }}</h2>
        <p style="margin: 10px 0 0 0; opacity: 0.9;">Pendientes Hoy</p>
    </div>
    
    <div style="background: linear-gradient(135deg, #D52B1E 0%, #B71C1C 100%); color: white; padding: 20px; border-radius: 10px; text-align: center; box-shadow: 0 8px 20px rgba(0, 0, 0, 0.35);">
        <h2 style="font-size: 48px; margin: 0;">{{ tarjetas_nuevas_hoy }} </h2>
        <p style="margin: 10px 0 0 0; opacity: 0.9;">Nuevas Hoy</p>
    </div>
</div>

<div style="margin-top: 40px;">
    <h2> Distribución por Estado</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px;">

        <div style="background: #F5F5F5; padding: 15px; border-radius: 8px; border-left: 4px solid #bbbbbb; box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);">
            <strong> Aprendizaje:</strong> {{ tarjetas_aprendizaje }}
        </div>
        <div style="background: #F5F5F5; padding: 15px; border-radius: 8px; border-left: 4px solid #0039A6; box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);">
            <strong> Consolidación:</strong> {{ tarjetas_consolidacion }}
        </div>
        <div style="background: #F5F5F5; padding: 15px; border-radius: 8px; border-left: 4px solid #D52B1E; box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);">
            <strong> Maduras:</strong> {{ tarjetas_maduras }}
        </div>
    </div>
</div>

<div id="contenedor-repaso" 
     style="margin-top: 40px; text-align: center; display: flex; gap: 25px; justify-content: center; flex-wrap: wrap;">
    {% if tarjetas_pendientes > 0 %}
    <a id="boton-repaso" href="{% url 'sesion_repaso' %}" class="btn" 
       style="font-size: 20px; padding: 18px 30px; background: #28a745;">
        Comenzar Repaso ({{ tarjetas_pendientes }} pendiente{{ tarjetas_pendientes|pluralize }})
    </a>
    {% endif %}
    <a href="{% url 'crear_tarjeta' %}" class="btn" style="font-size: 18px; padding: 18px 30px;"> Crear Nueva Tarjeta</a>
</div>


<script>
async function actualizarBotonRepaso() {
    try {
        const response = await fetch("{% url 'tarjetas_pendientes_api' %}");
        const data = await response.json();
        const contenedor = document.getElementById('contenedor-repaso');
        const botonExistente = document.getElementById('boton-repaso');

        if (data.pendientes > 0) {
            // Crear o actualizar el botón
            const texto = ` Comenzar Repaso (${data.pendientes} pendiente${data.pendientes === 1 ? '' : 's'})`;
            if (botonExistente) {
                botonExistente.textContent = texto;
            } else {
                const nuevoBoton = document.createElement('a');
                nuevoBoton.id = 'boton-repaso';
                nuevoBoton.href = "{% url 'sesion_repaso' %}";
                nuevoBoton.className = 'btn';
                nuevoBoton.style = "font-size: 20px; padding: 18px 40px; background: #28a745;";
                nuevoBoton.textContent = texto;
                contenedor.prepend(nuevoBoton);
            }
        } else if (botonExistente) {
            // Eliminar el botón si ya no hay tarjetas
            botonExistente.remove();
        }
    } catch (error) {
        console.error('Error al actualizar botón de repaso:', error);
    }
}

// Ejecutar al cargar y cada 30s
actualizarBotonRepaso();
setInterval(actualizarBotonRepaso, 5000);
</script>


{% endblock %}
